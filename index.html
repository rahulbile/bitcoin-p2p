<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Price Calculator</title>
</head>
<body>
    <h1>Bitcoin Price Calculator (Spot Price via Exchange) </h1>

    <label for="exchange">Select Exchange:</label>
    <select id="exchange" onchange="fetchCurrentPrice()">
        <option value="coindcx" data-symbol="">CoinDcx</option>
        <option value="coingecko" data-symbol="">CoinGecko</option>
        <option value="coinbase" data-symbol="$">Coinbase</option>
    </select>

    <p id="current-price">Current Price: Loading...</p>

    <label for="btc-amount"> BTC / Sats Amount:</label>
    <input type="number" id="btc-amount" placeholder="Enter amount">

    <br>

    <!-- Bitcoin/Sats selector -->
    <label for="btc-type">Select Type:</label>
    <select id="btc-type">
        <option value="btc">Bitcoin (BTC)</option>
        <option value="sats">Satoshis (Sats)</option>
    </select>

    <br>

    <label for="currency">Select Currency:</label>
    <select id="currency" onchange="fetchCurrentPrice()">
        <option value="inr" data-symbol="₹">INR (₹)</option>
        <!-- <option value="usd" data-symbol="$">USD ($)</option>
        <option value="eur" data-symbol="€">EUR (€)</option> -->
    </select>

    <br>

    <label for="premium">Add Premium (%):</label>
    <input type="number" id="premium" placeholder="Enter premium percentage" step="1" value="10">

    <button onclick="calculatePrice()">Calculate</button>
    <br>

    <!-- Text Area for Result Display -->
    <label for="price-result">Calculation Result:</label>
    <br>
    <textarea id="price-result" readonly rows="4" cols="50"></textarea>

    <!-- Copy Button -->
    <button onclick="copyToClipboard()">Copy Result to Clipboard</button>

    <h1>Bitcoin Sale Calculator (Custom Spot Price)  </h1>

    <!-- Input field for manually specifying the BTC price -->
    <label for="btc-price-custom">Specify Bitcoin Price (in your currency):</label>
    <input type="number" id="btc-price-custom" placeholder="Enter BTC price in your currency" step="any">
    <br><br>

    <!-- Input field for entering the amount in currency to sell -->
    <label for="currency-amount-custom">Enter Amount in Currency (e.g., INR):</label>
    <input type="number" id="currency-amount-custom" placeholder="Enter amount in currency">
    <br><br>

    <button onclick="calculateSatoshis()">Calculate</button>
    <br><br>

    <!-- Text Area for Result Display -->
    <label for="price-result-custom">Calculation Result:</label>
    <br>
    <textarea id="price-result-custom" readonly rows="4" cols="50"></textarea>

    <!-- Copy Button -->
    <button onclick="copyToClipboardCustom()">Copy Result to Clipboard</button>

    <script>
        // Function to convert BTC to Satoshis (1 BTC = 100,000,000 Satoshis)
        function convertBTCtoSats(btc) {
            return btc * 100000000;  // 1 BTC = 100 million Satoshis
        }

        // Function to calculate Satoshis based on the entered amount and BTC price
        function calculateSatoshis() {
            const btcPrice = document.getElementById("btc-price-custom").value;
            const currencyAmount = document.getElementById("currency-amount-custom").value;

            if (!btcPrice || !currencyAmount) {
                document.getElementById("price-result-custom").value = "Please enter both BTC price and amount in currency.";
                return;
            }

            // Calculate the amount of BTC the user is selling for the entered currency amount
            const btcAmount = currencyAmount / btcPrice;

            // Convert the BTC amount to Satoshis
            const satoshis = convertBTCtoSats(btcAmount);

            // Display the result
            const resultMessage = `
Selling  ${satoshis.toFixed(0)} Satoshis  (${convertSatsToBTC(satoshis).toFixed(6)} BTC) for INR ${currencyAmount} with Spot price as INR ${btcPrice} per BTC.
            `;
            document.getElementById("price-result-custom").value = resultMessage.trim();
        }

        // Function to copy the result to clipboard
        function copyToClipboardCustom() {
            const copyText = document.getElementById("price-result-custom");
            copyText.select();
            copyText.setSelectionRange(0, 99999);  // For mobile devices

            try {
                document.execCommand("copy");
            } catch (err) {
                alert("Failed to copy!");
            }
        }

        // Fetch Bitcoin Price from CoinGecko
        async function fetchFromCoinGecko(currency) {
            const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=${currency}`);
            const data = await response.json();
            return data.bitcoin[currency];
        }

        // Fetch Bitcoin Price from CoinDcx
        async function fetchFromCoinDcx(currency) {
            const response = await fetch(`https://api.coindcx.com/exchange/ticker`);
            const data = await response.json();
            const btcInrData = data.filter(d => d.market === 'BTCINR');
            return btcInrData[0].last_price;
        }

        // Fetch Bitcoin Price from Coinbase
        async function fetchFromCoinbase(currency) {
            const response = await fetch(`https://api.coinbase.com/v2/prices/btc-inr/spot`);
            const data = await response.json();
            return data.data.amount;
        }

        // Get the selected currency symbol
        function getCurrencySymbol() {
            const currency = document.getElementById("currency");
            const symbol = currency.options[currency.selectedIndex].getAttribute("data-symbol");
            return symbol;
        }

        // Convert Satoshis to Bitcoin
        function convertSatsToBTC(sats) {
            return sats / 100000000;  // 1 Bitcoin = 100,000,000 Satoshis
        }

        // Fetch the current price based on the selected exchange
        async function fetchCurrentPrice() {
            const exchange = document.getElementById("exchange").value;
            const currency = document.getElementById("currency").value;
            const currencySymbol = getCurrencySymbol();

            let price;

            if (exchange === 'coingecko') {
                price = await fetchFromCoinGecko(currency);
            } else if (exchange === 'coinbase') {
                price = await fetchFromCoinbase(currency);
            } else if (exchange === 'coindcx') {
                price = await fetchFromCoinDcx(currency);
            }

            // Update the current price display with currency symbol
            document.getElementById("current-price").innerHTML = `
                Current Price from ${exchange.toUpperCase()}: ${currencySymbol}${parseFloat(price).toFixed(2)} (${currency.toUpperCase()})
            `;
            return price;
        }

        // Calculate the price based on the selected exchange, currency, and premium
        async function calculatePrice() {
            const btcAmount = document.getElementById("btc-amount").value;
            const btcType = document.getElementById("btc-type").value;
            const currency = document.getElementById("currency").value;
            const premiumPercentage = document.getElementById("premium").value;
            const currencySymbol = getCurrencySymbol();
            const exchange = document.getElementById("exchange").value;

            if (!btcAmount || !premiumPercentage) {
                document.getElementById("price-result").value = "Please enter all values!";
                return;
            }

            // Convert btcAmount to a float to ensure it's treated as a number
            let btcValue = parseFloat(btcAmount);

            // Convert Satoshis to Bitcoin if user selects Sats
            if (btcType === "sats") {
                btcValue = parseFloat(btcAmount) / 100000000;  // Convert sats to BTC
            }

            const price = await fetchCurrentPrice();  // Fetch current price based on exchange

            let valueWithoutPremium = btcValue * price;

            // Add the premium
            const premium = valueWithoutPremium * (premiumPercentage / 100);
            const valueWithPremium = valueWithoutPremium + premium;

            // Display both values (with and without premium) in the text area along with the currency symbol
            const message = `
        Selling ${btcAmount} ${btcType === 'sats' ? 'Satoshis' : 'BTC'} (${btcValue.toFixed(8)} BTC) with ${premiumPercentage}% Premium for ${currencySymbol}${valueWithPremium.toFixed(2)} ( ${exchange.toUpperCase()} Spot price: ${currencySymbol}${parseFloat(price).toFixed(2)} )
            `;
            document.getElementById("price-result").value = message.trim();  // Show in textarea
        }

        // Function to copy the message to clipboard
        function copyToClipboard() {
            const copyText = document.getElementById("price-result");
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand("copy");
            } catch (err) {
                alert("Failed to copy!");
            }
        }

        // Call fetchCurrentPrice when the page loads to show the default price (CoinGecko)
        window.onload = fetchCurrentPrice;
    </script>
</body>
</html>
